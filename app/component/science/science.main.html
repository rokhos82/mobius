<page-title title="Science Manager" message="{{$ctrl.welcome}}"></page-title>
<page-alerts alerts="$ctrl.alerts.general"></page-alerts>
<div class="row">
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="well well-sm">
          <form class="form-horizontal" ng-init="newProject={}">
            <fieldset>
              <legend class="text-info">New Research Project</legend>
              <mobius-text label="Project Name" value="newProject.name"></mobius-text>
              <mobius-select mobius-options="$ctrl.stages" mobius-selector="stage.name disable when stage.finis for stage" mobius-label="Project Stage" mobius-selected="newProject.stage"></mobius-select>
              <mobius-number label="Level" placeholder="If the project can have multiple levels enter that here." value="newProject.level" checkbox="Use level in name" checkbox-model="newProject.useLevel"></mobius-number>
              <mobius-number label="Project Bonus" placeholder="10" value="newProject.bonus"></mobius-number>
              <mobius-number label="Chance of Failure" placeholder="1" value="newProject.failChance"></mobius-number>
              <div class="form-group">
                <div class="col-lg-12">
                  <button class="btn btn-success btn-block" type="button" ng-click="$ctrl.addProject(newProject);">Create Project</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
        <div class="well well-sm">
          <form class="form-horizontal">
            <fieldset>
              <legend class="text-info">Research Bonuses</legend>
              <mobius-number label="Global Bonus" placeholder="0" value="$ctrl.bonus.global"></mobius-number>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="mobius-title text-info">Active Science Projects</h4>
      </div>
      <div class="panel-body">
        <div class="btn-toolbar">
          <div class="btn-group" uib-dropdown>
            <button class="btn btn-default" uib-dropdown-toggle>Apply to Checked <span class="caret"></span></button>
            <ul class="dropdown-menu" uib-dropdown-menu role="menu">
              <!--<li role="menuitme"><a href>Update</a></li>
              <li role="menuitem"><a href>Reroll</a></li>-->
              <li role="menuitem"><a href ng-click="$ctrl.removeSelectedProjects()">Remove</a></li>
            </ul>
          </div>
          <div class="btn-group">
            <button class="btn btn-success" type="button" ng-click="$ctrl.fundProjects($ctrl.projects)">Fund Projects</button>
            <button class="btn btn-info" type="button" ng-click="$ctrl.rollProjects()">Update Projects</button>
          </div>
          <div class="btn-group">
            <button class="btn btn-default" type="button" ng-click="$ctrl.onImportProjects()">Import Projects</button>
            <button class="btn btn-default" type="button" ng-click="$ctrl.exportProjects()">Export Projects</button>
          </div>
          <div class="btn-group" uib-dropdown ng-if"$ctrl.user.level <= 5">
            <button class="btn btn-default" uib-dropdown-toggle>Tools <span class="caret"></span></button>
            <ul class="dropdown-menu" uib-dropdown-menu role="menu">
              <li role="menuitem"><a href>Mass Add Projects</a></li>
              <li role="menuitem"><a href ng-click="$ctrl.clearProjects()">Clear Projects</a></li>
            </ul>
          </div>
        </div>
      </div>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th><input type="checkbox" class="mob-checkbox-lg" id="checkAll" ng-model="$ctrl.ui.selectAllProjects" ng-click="$ctrl.checkAllProjects();" /></th>
            <th>Project</th>
            <th>Stage</th>
            <th>Turn Funding</th>
            <th>Total Funding</th>
            <th>Project Bonus</th>
            <th>Total Bonus</th>
            <th>Roll</th>
          </tr>
        </thead>
        <tfoot>
          <tr><th colspan="8" class="text-warning">Total Funding: {{$ctrl.totalFunding()}}</th></tr>
        </tfoot>
        <tbody>
          <tr class="mobius-table-row" ng-repeat="project in $ctrl.projects | activeResearch track by $index" ng-click="$ctrl.updateProjects([project])" ng-class="{'text-warning':project.stage.index == 0,'text-info':project.stage.index == 1,'text-success':project.stage.index == 2}">
            <td><input type="checkbox" class="mob-checkbox-lg" id="{{'project'+$index}}" ng-click="$event.stopPropagation();" ng-model="$ctrl.ui.selectedProjects[project.uuid]" /></td>
            <td>{{project.name}}<span ng-if="project.useLevel"> (Level {{project.level}})</span></td>
            <td>{{project.stage.name}}</td>
            <td>{{project.funding}}</td>
            <td>{{project.totalFunding}}</td>
            <td>{{project.bonus}}</td>
            <td>{{project.bonus + $ctrl.bonus.global}}</td>
            <td>{{project.roll}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <page-alerts alerts="$ctrl.alerts.research"></page-alerts>
  </div>
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="mobius-title text-info">Event Log</h4>
      </div>
      <table class="table table-striped table-hover">
        <tbody>
          <tr ng-repeat="event in $ctrl.events track by $index" ng-class="['mobius-table-row']">
            <td class="text-info text-right">{{$index+1}}</td>
            <td ng-class="{'text-success': event.success, 'text-danger': event.fail, 'text-warning': (!event.success && !event.fail)}">{{event.text}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="mobius-title text-info">Completed Research Projects</h4>
      </div>
      <table class="table table-striped table-hover">
        <thead>
          <tr><th>Project</th><th>Stage</th><th>Total Funding</th><th>Project Bonus</th></tr>
        </thead>
        <tbody>
          <tr class="mobius-table-row" ng-repeat="project in $ctrl.projects | completedResearch track by $index">
            <td>{{project.name}}<span ng-if="project.useLevel"> (Level {{project.level}}) </span><span class="glyphicon glyphicon-open text-info" ng-if="project.level"></span></td>
            <td>{{project.stage.name}}</td>
            <td>{{project.totalFunding}}</td>
            <td>{{project.bonus}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" ng-if="$ctrl.user.level <= 0">
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="well well-sm">
          <div class="input-group has-warning">
            <input type="text" class="form-control" ng-model="commandText" />
            <spann class="input-group-btn">
              <button class="btn btn-warning" type="button" ng-click="commandOutput = $ctrl.execute(commandText); commandText=''">Execute</button>
            </span>
          </div>
          <hr />
          <div class="text-warning" style="text-warp: normal;">{{commandOutput}}</div>
        </div>
      </div>
    </div>
  </div>
</div>
